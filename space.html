<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link rel="icon" href="PNGs/favicon5.ico">
    <title>My Space</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --primary-color: #000;
            --secondary-color: #000;
            --accent-color: #000;
            --light-color: #f8f9fa;
            --dark-color: #000;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
            --notion-bg: #f7f7f7;
            --notion-text: #000;
            --notion-border: #e0e0e0;
            --notion-button-bg: #e0e0e0;
            --notion-button-hover: #d0d0d0;
            --notion-red: #f66;
            --notion-green: #27ae60;
            --notion-blue: #3082fc;
            --notion-yellow: #ff8b47;
            --notion-purple: #9b51e0;
            --streak-color: #FF5722;
            --streak-inactive: #757575;
            --excellent-color: #4CAF50;
            --good-color: #FFC107;
            --fair-color: #FF9800;
            --poor-color: #F44336;
            --ring-bg-color: rgba(255, 255, 255, 0.1);
            --saved-day-bg: #e8f5e9;
            --saved-day-border: #c8e6c9;
            --saved-day-text: #2e7d32;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-image: url('PNGs/pic2.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 0;
            width: 100vw;
            overflow-x: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }

        .section {
            margin: 10px auto;
            border-radius: 30px;
            box-shadow: 0 6px 18px rgba(0,0,0, 0.6);
            background-color: rgba(255, 255, 255, 0.1);
            padding: 20px;
            width: calc(100% - 20px);
            max-width: 1200px;
            overflow-y: auto;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #000;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
            transition: var(--transition);
        }

        .calendar {
            width: 100%;
        }

        .calendar-header {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (min-width: 400px) {
            .calendar-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .calendar-title {
            font-size: 1.3rem;
            font-weight: 500;
            color: #000;
        }

        .streak-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 15px;
            order: 2;
        }

        @media (min-width: 400px) {
            .streak-container {
                order: 0;
                margin: 0;
                margin-right: auto;
            }
        }

        .streak-fire {
            position: relative;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: var(--transition);
        }

            .streak-fire.active {
                color: var(--streak-color);
                filter: drop-shadow(0 0 5px rgba(255, 87, 34, 0.5));
                animation: flame-pulse 2s infinite alternate;
            }

            .streak-fire.inactive {
                color: var(--streak-inactive);
                opacity: 0.5;
            }

        @keyframes flame-pulse {
            0% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px rgba(255, 87, 34, 0.5));
            }

            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 8px rgba(255, 87, 34, 0.7));
            }

            100% {
                transform: scale(1);
                filter: drop-shadow(0 0 5px rgba(255, 87, 34, 0.5));
            }
        }

        .streak-count {
            font-size: 1.1rem;
            font-weight: 700;
            color: #000;
            min-width: 20px;
            text-align: center;
        }

        .calendar-nav-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            order: 3;
        }

        @media (min-width: 400px) {
            .calendar-nav-wrapper {
                order: 0;
            }
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav-btn {
            padding: 5px 10px;
            border: none;
            border-radius: var(--border-radius);
            background-color: var(--primary-color);
            color: #fff;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7,1fr);
            gap: 5px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 500;
            padding: 6px;
            font-size: .7rem;
            color: #000;
        }

        @media (min-width:350px) {
            .calendar-day-header {
                padding: 8px;
                font-size: .8rem;
            }
        }

        .calendar-day {
            aspect-ratio: 1;
            background-color: #fff;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 4px rgba(0,0,0,0.6);
            padding: 5px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            position: relative;
        }

            .calendar-day.saved {
                background-color: var(--saved-day-bg) !important;
                border-color: var(--saved-day-border) !important;
                border-width: 2px;
            }

                .calendar-day.saved .calendar-day-number {
                    color: var(--saved-day-text);
                    font-weight: 700;
                }

        @media (max-width:500px) {
            .calendar-day {
                height: 100%;
            }

            .day-mood-indicator,
            .day-sleep-indicator,
            .day-water-indicator {
                display: none !important;
            }
        }

        .calendar-day:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .calendar-day-number {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.9rem;
            text-align: center;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            margin: 3px 0;
            font-size: .8rem;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--notion-bg);
            border-radius: 35px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            padding: 20px;
            width: 95%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            color: var(--notion-text);
            font-family: 'Roboto',sans-serif;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--notion-border);
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--notion-text);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--notion-text);
            opacity: .6;
            transition: opacity .2s ease;
        }

        .modal-section {
            margin-bottom: 25px;
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.3s ease, transform 0.3s ease, max-height 0.3s ease;
            max-height: 500px;
            overflow: hidden;
        }

        .modal-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--notion-text);
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: .95rem;
            color: var(--notion-text);
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 6px;
            background: var(--notion-border);
            border-radius: 3px;
            outline: none;
            opacity: .7;
            transition: opacity .2s;
        }

            input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 18px;
                height: 18px;
                border-radius: 50%;
                background: var(--notion-blue);
                cursor: pointer;
                box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            }

        .slider-value {
            font-weight: 500;
            color: var(--notion-blue);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .notion-button {
            padding: 8px 15px;
            border: 1px solid var(--notion-border);
            border-radius: 5px;
            background-color: var(--notion-button-bg);
            color: var(--notion-text);
            font-size: .9rem;
            cursor: pointer;
            transition: background-color .2s ease, border-color .2s ease;
        }

            .notion-button.selected {
                background-color: var(--notion-blue);
                color: #fff;
                border-color: var(--notion-blue);
            }

            .notion-button[data-negative="true"].selected {
                background-color: var(--notion-red);
                border-color: var(--notion-red);
                color: #fff;
            }

            .notion-button[data-value="optimal"].selected {
                background-color: var(--notion-green);
                border-color: var(--notion-green);
                color: #fff;
            }

            .notion-button[data-value="eno23"].selected {
                background-color: dodgerblue;
                border-color: dodgerblue;
                color: #fff;
            }

            .notion-button[data-value="very-little"].selected {
                background-color: var(--notion-red);
                border-color: var(--notion-red);
                color: #fff;
            }

            .notion-button[data-value="little"].selected {
                background-color: #ff7f50;
                border-color: #ff7f50;
                color: #fff;
            }

            .notion-button[data-value="enough"].selected {
                background-color: var(--notion-green);
                border-color: var(--notion-green);
                color: #fff;
            }

            .notion-button[data-value="much"].selected {
                background-color: #4682b4;
                border-color: #4682b4;
                color: #fff;
            }

            .notion-button[data-value="very-much"].selected {
                background-color: #1e90ff;
                border-color: #1e90ff;
                color: #fff;
            }

        .notion-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--notion-border);
            border-radius: 5px;
            resize: vertical;
            min-height: 80px;
            font-family: 'Roboto',sans-serif;
            font-size: .95rem;
            color: var(--notion-text);
            background-color: #fff;
            transition: border-color .2s ease;
        }

        .save-day-btn {
            width: 100%;
            padding: 12px 20px;
            border: none;
            border-radius: 15px;
            background-color: var(--notion-blue);
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color .2s ease;
            margin-top: 20px;
        }

        .day-indicators {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2px;
            margin-top: auto;
            min-height: 16px;
        }

        #toast-container {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 320px;
            pointer-events: none;
        }

        .toast {
            background-color: #333;
            color: #fff;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            font-size: 16px;
            opacity: 0;
            animation: slideDown .3s forwards, fadeOut .3s forwards 2.7s;
            pointer-events: auto;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        .conditional-section {
            display: none;
            margin-bottom: 25px;
        }

        .calendar-day.today {
            border: 2px solid #ff6b6b;
            background-color: #fff5f5;
        }

        .health-score-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .health-score-circle-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .health-score-circle {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .ring-circle {
            cx: 100;
            cy: 100;
            r: 90;
            fill: none;
            stroke-width: 6;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .ring-background {
            stroke: rgba(0, 0,0, 0.5);
            ;
        }

        .ring-progress {
            stroke: url(#ringGradient);
            stroke-dasharray: 565;
            stroke-dashoffset: 565;
            transition: stroke-dashoffset 1s ease-out;
        }

        .ring-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            width: 140px;
            pointer-events: none;
        }

        .score-value {
            font-size: 3.2rem;
            font-weight: 700;
            color: #000;
            line-height: 1;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
        }

        .score-label {
            font-size: 0.85rem;
            color: #000;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .health-score-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            margin-top: 20px;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            max-height: 500px;
            opacity: 1;
            overflow: hidden;
        }

            .health-score-details.collapsed {
                max-height: 0;
                margin-top: 0;
                margin-bottom: 0;
                opacity: 0;
                gap: 0;
                transform: translateY(-10px);
            }

        .score-category {
            border-radius: 20px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: all 0.3s ease;
            position: relative;
            aspect-ratio: 1 / 1;
            overflow: hidden;
        }

            .score-category.sleep-category {
                background-color: rgba(255, 255, 255, 0.6);
                border: 1px solid rgba(0, 0, 0, 0.3);
            }

            .score-category.water-category {
                background-color: rgba(255, 255, 255, 0.6);
                border: 1px solid rgba(0, 0, 0, 0.3);
            }

            .score-category.activity-category {
                background-color: rgba(255, 255, 255, 0.6);
                border: 1px solid rgba(0, 0, 0, 0.3);
            }

            .score-category.mood-category {
                background-color: rgba(255, 255, 255, 0.6);
                border: 1px solid rgba(0, 0, 0, 0.3);
            }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 5px;
        }

        .category-name {
            font-size: 0.95rem;
            color: #000;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
            max-width: 70%;
        }

        .category-score {
            font-size: 1.1rem;
            font-weight: 600;
            color: #000;
            white-space: nowrap;
        }

        .score-bar {
            height: 6px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: auto;
        }

        .score-fill {
            height: 100%;
            width: 0%;
            transition: width 0.8s ease 0.3s;
            border-radius: 3px;
        }

        .verdict-description {
            text-align: center;
            font-size: 1rem;
            margin-top: 10px;
            font-weight: 500;
            animation: fadeIn 0.5s ease;
            color: #000;
            line-height: 1.4;
            padding: 0 10px;
        }

        .day-saved-indicator {
            position: absolute;
            top: 3px;
            right: 3px;
            font-size: 0.7rem;
            color: #28a745;
        }

        .day-activity-indicator {
            font-size: 0.7rem;
            margin: 0 1px;
        }

        .day-mood-indicator,
        .day-sleep-indicator,
        .day-water-indicator {
            font-size: 0.7rem;
            margin: 0 1px;
        }

        .saved-day-checkmark {
            position: absolute;
            top: 3px;
            right: 3px;
            font-size: 0.8rem;
            color: var(--saved-day-text);
            font-weight: bold;
        }

        .score-description {
            color: #000;
            font-size: 0.8rem;
            line-height: 1.3;
            margin-top: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            flex-grow: 1;
        }

        /* –†‚Äù–†¬ª–°–è –†—ï–°‚Ä°–†¬µ–†–Ö–°–ä –†—ò–†¬∞–†¬ª–†¬µ–†–Ö–°–ä–†—î–†—ë–°‚Ä¶ –°–å–†—î–°–Ç–†¬∞–†–Ö–†—ï–†–Ü */
        @media (max-width: 360px) {
            .score-category {
                padding: 10px;
                gap: 6px;
            }

            .category-name {
                font-size: 0.85rem;
                gap: 4px;
            }

            .category-score {
                font-size: 1rem;
            }

            .score-description {
                font-size: 0.75rem;
                -webkit-line-clamp: 1;
            }

            .health-score-details {
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            .section {
                padding: 15px;
                border-radius: 20px;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .health-score-circle-wrapper {
                width: 160px;
                height: 160px;
            }

            .score-value {
                font-size: 2.5rem;
            }
        }

        /* –†‚Äù–†¬ª–°–è –°–É–°–Ç–†¬µ–†“ë–†–Ö–†—ë–°‚Ä¶ –†—ë –†¬±–†—ï–†¬ª–°–ä–°‚Ç¨–†—ë–°‚Ä¶ –°–å–†—î–°–Ç–†¬∞–†–Ö–†—ï–†–Ü - –°—ì–†–Ü–†¬µ–†¬ª–†—ë–°‚Ä°–†—ë–†–Ü–†¬∞–†¬µ–†—ò –†—î–†–Ü–†¬∞–†“ë–°–Ç–†¬∞–°‚Äö–°‚Äπ */
        @media (min-width: 481px) {
            .health-score-details {
                gap: 15px;
            }

            .score-category {
                padding: 15px;
                gap: 10px;
            }

            .category-name {
                font-size: 1rem;
            }

            .category-score {
                font-size: 1.2rem;
            }

            .score-bar {
                height: 8px;
            }

            .score-description {
                font-size: 0.85rem;
                -webkit-line-clamp: 3;
            }
        }

        /* –†—í–†–Ö–†—ë–†—ò–†¬∞–°‚Ä†–†—ë–°–è –†“ë–†¬ª–°–è –†—ó–†—ï–°–è–†–Ü–†¬ª–†¬µ–†–Ö–†—ë–°–è */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    

    <div class="section">
        <h2 class="section-title">
            <span class="title-text">
                <span class="title-icon"></span>
                Daily Tracking
            </span>
        </h2>
        <div class="calendar">
            <div class="calendar-header">
                <div class="calendar-title" id="current-month-year">June 2023</div>
                <div class="calendar-nav-wrapper">
                    <div class="streak-container">
                        <div class="streak-fire" id="streak-fire">üî•</div>
                        <div class="streak-count" id="streak-count">0</div>
                    </div>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" id="prev-month">Previous</button>
                        <button class="calendar-nav-btn" id="next-month">Next</button>
                    </div>
                </div>
            </div>
            <div class="calendar-grid" id="calendar-days-header">
                <div class="calendar-day-header">Sun</div>
                <div class="calendar-day-header">Mon</div>
                <div class="calendar-day-header">Tue</div>
                <div class="calendar-day-header">Wed</div>
                <div class="calendar-day-header">Thu</div>
                <div class="calendar-day-header">Fri</div>
                <div class="calendar-day-header">Sat</div>
            </div>
            <div class="calendar-grid" id="calendar-days"></div>
        </div>
    </div>

    <div class="modal" id="day-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-day-title">Day Details</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-section" id="sleep-section">
                <div class="modal-section-title">Sleep</div>
                <div class="slider-container">
                    <label class="slider-label" for="sleep-slider">
                        <span>Hours Slept</span>
                        <span id="sleep-value" class="slider-value">7.0 hrs</span>
                    </label>
                    <input type="range" id="sleep-slider" min="0" max="14" step="0.1" value="7">
                </div>
                <div class="button-group" id="sleep-quality-buttons">
                    <button class="notion-button" data-value="">Slept Well</button>
                    <button class="notion-button" data-value="poor-sleep" data-negative="true">Poor Sleep</button>
                </div>
            </div>
            <div class="modal-section conditional-section" id="sleep-issues-section">
                <div class="modal-section-title">Sleep Issues</div>
                <div class="button-group" id="sleep-issues-buttons">
                    <button class="notion-button" data-value="insomnia" data-negative="true">Insomnia</button>
                    <button class="notion-button" data-value="early-wakeup" data-negative="true">Early Wakeup</button>
                    <button class="notion-button" data-value="fragmented-sleep" data-negative="true">Fragmented Sleep</button>
                    <button class="notion-button" data-value="difficulty-falling-asleep" data-negative="true">Difficulty Falling Asleep</button>
                    <button class="notion-button" data-value="non-restorative-sleep" data-negative="true">Non-Restorative Sleep</button>
                    <button class="notion-button" data-value="daytime-sleepiness" data-negative="true">Daytime Sleepiness</button>
                </div>
            </div>
            <div class="modal-section" id="water-section">
                <div class="modal-section-title">Water Intake</div>
                <div class="button-group" id="water-intake-buttons">
                    <button class="notion-button" data-value="optimal">Optimal</button>
                    <button class="notion-button" data-value="enough">Enough</button>
                    <button class="notion-button" data-value="little">Little</button>
                    <button class="notion-button" data-value="too-little" data-negative="true">Too Little</button>
                </div>
            </div>
            <div class="modal-section conditional-section" id="dehydration-section">
                <div class="modal-section-title">Dehydration Symptoms</div>
                <div class="button-group" id="dehydration-buttons">
                    <button class="notion-button" data-value="headache" data-negative="true">Headache</button>
                    <button class="notion-button" data-value="fatigue" data-negative="true">Fatigue</button>
                    <button class="notion-button" data-value="dry-skin-mucous" data-negative="true">Dry Skin & Mucous</button>
                    <button class="notion-button" data-value="poor-concentration" data-negative="true">Poor Concentration</button>
                </div>
            </div>
            <div class="modal-section" id="mood-section">
                <div class="modal-section-title">Mood</div>
                <div class="slider-container">
                    <label class="slider-label" for="mood-slider">
                        <span>How did you feel today? (1-10)</span>
                        <span id="mood-value" class="slider-value">5</span>
                    </label>
                    <input type="range" id="mood-slider" min="1" max="10" value="5">
                </div>
            </div>
            <div class="modal-section conditional-section" id="mood-related-section">
                <div class="modal-section-title">Mood Related</div>
                <div class="button-group" id="mood-related-buttons">
                    <button class="notion-button" data-value="stress" data-negative="true">Stress</button>
                    <button class="notion-button" data-value="anxiety" data-negative="true">Anxiety</button>
                    <button class="notion-button" data-value="apathy" data-negative="true">Apathy</button>
                    <button class="notion-button" data-value="depressive-episode" data-negative="true">Depressive Episode</button>
                    <button class="notion-button" data-value="irritability" data-negative="true">Irritability</button>
                    <button class="notion-button" data-value="social-isolation" data-negative="true">Social Isolation</button>
                    <button class="notion-button" data-value="mood-swings" data-negative="true">Mood Swings</button>
                </div>
            </div>
            <div class="modal-section" id="activity-level-section">
                <div class="modal-section-title">Activity Level</div>
                <div class="slider-container">
                    <label class="slider-label" for="activity-slider">
                        <span>How active were you today? (1-10)</span>
                        <span id="activity-value" class="slider-value">5</span>
                    </label>
                    <input type="range" id="activity-slider" min="1" max="10" value="5">
                </div>
            </div>
            <div class="modal-section conditional-section" id="activity-issues-section">
                <div class="modal-section-title">Activity Issues</div>
                <div class="button-group" id="activity-issues-buttons">
                    <button class="notion-button" data-value="sedentary-day" data-negative="true">Sedentary Day</button>
                    <button class="notion-button" data-value="overtraining" data-negative="true">Overtraining</button>
                    <button class="notion-button" data-value="bad-mood" data-negative="true">Bad Mood</button>
                    <button class="notion-button" data-value="reduced-metabolism" data-negative="true">Reduced Metabolism</button>
                    <button class="notion-button" data-value="muscle-weakness" data-negative="true">Muscle Weakness</button>
                    <button class="notion-button" data-value="increased-stress" data-negative="true">Increased Stress</button>
                    <button class="notion-button" data-value="chronic-fatigue" data-negative="true">Chronic Fatigue</button>
                </div>
            </div>
            <div class="modal-section" id="notes-section">
                <div class="modal-section-title">Notes</div>
                <textarea class="notion-textarea" id="day-notes" placeholder="Write your notes for the day..."></textarea>
            </div>
            <button class="save-day-btn" id="save-day-btn">Save Day</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        // =================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø LOCALSTORAGE ===================
const DAYS_STORAGE_KEY = 'health_tracker_days';
const STREAK_STORAGE_KEY = 'health_tracker_streak';
const LAST_SAVED_DATE_KEY = 'health_tracker_last_saved_date';

// =================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø HEALTH SCORE ===================
const HEALTH_SCORE_CONFIG = {
    sleep: {
        weight: 40,
        optimalHours: { min: 7, max: 8 },
        scores: {
            optimal: 100,
            good: 80,
            fair: 60,
            poor: 40,
            veryPoor: 20
        },
        poorSleepPenalty: 30,
        symptomPenalty: 10
    },
    water: {
        weight: 20,
        scores: {
            'optimal': 100,
            'enough': 80,
            'little': 40,
            'too-little': 20
        },
        symptomPenalty: 15
    },
    mood: {
        weight: 20,
        scores: {
            10: 100, 9: 90, 8: 80, 7: 70, 6: 60, 5: 50,
            4: 40, 3: 30, 2: 20, 1: 10
        },
        lowMoodPenalty: 25,
        symptomPenalty: 10
    },
    activity: {
        weight: 20,
        optimalRange: { min: 5, max: 7 },
        scores: {
            10: 90, 9: 85, 8: 80, 7: 75, 6: 70, 5: 65,
            4: 55, 3: 45, 2: 35, 1: 25
        },
        lowActivityPenalty: 20,
        highActivityPenalty: 15,
        symptomPenalty: 10
    }
};

// =================== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° LOCALSTORAGE ===================
function getDaysFromStorage() {
    try {
        const days = localStorage.getItem(DAYS_STORAGE_KEY);
        return days ? JSON.parse(days) : {};
    } catch (error) {
        console.error('Error reading days from localStorage:', error);
        return {};
    }
}

function saveDayToStorage(date, dayData) {
    try {
        const days = getDaysFromStorage();
        days[date] = {
            ...dayData,
            savedAt: new Date().toISOString()
        };
        localStorage.setItem(DAYS_STORAGE_KEY, JSON.stringify(days));
        return true;
    } catch (error) {
        console.error('Error saving day to localStorage:', error);
        return false;
    }
}

function getDayFromStorage(date) {
    const days = getDaysFromStorage();
    return days[date] || null;
}

function getStreakFromStorage() {
    try {
        const streakData = localStorage.getItem(STREAK_STORAGE_KEY);
        return streakData ? JSON.parse(streakData) : { currentStreak: 0, lastDate: null };
    } catch (error) {
        console.error('Error reading streak from localStorage:', error);
        return { currentStreak: 0, lastDate: null };
    }
}

function updateStreakInStorage(date) {
    try {
        const streakData = getStreakFromStorage();
        const today = new Date(date);
        const lastDate = streakData.lastDate ? new Date(streakData.lastDate) : null;
        
        let currentStreak = streakData.currentStreak;
        let streakIncremented = false;
        
        if (lastDate) {
            const dayDiff = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));
            
            if (dayDiff === 1) {
                // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –¥–Ω–∏
                currentStreak++;
                streakIncremented = true;
            } else if (dayDiff > 1) {
                // –ü—Ä–æ–ø—É—â–µ–Ω—ã –¥–Ω–∏
                currentStreak = 1;
            }
            // dayDiff === 0: —Ç–æ—Ç –∂–µ –¥–µ–Ω—å, –Ω–µ –º–µ–Ω—è–µ–º streak
        } else {
            // –ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å
            currentStreak = 1;
            streakIncremented = true;
        }
        
        const newStreakData = {
            currentStreak: currentStreak,
            lastDate: today.toISOString().split('T')[0]
        };
        
        localStorage.setItem(STREAK_STORAGE_KEY, JSON.stringify(newStreakData));
        
        return {
            success: true,
            currentStreak: currentStreak,
            streakIncremented: streakIncremented
        };
    } catch (error) {
        console.error('Error updating streak:', error);
        return { success: false, currentStreak: 0, streakIncremented: false };
    }
}

// =================== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ===================
// =================== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô ===================
function createNotificationForDay(dayData, date) {
    try {
        console.log('Creating notification for day:', { date, dayData });
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–∏–º–ø—Ç–æ–º—ã
        const allSymptoms = [];
        const recommendations = [];
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–º–ø—Ç–æ–º—ã —Å–Ω–∞
        if (dayData.sleepQuality === 'poor-sleep') allSymptoms.push('poor-sleep');
        if (dayData.sleepIssues && dayData.sleepIssues.length > 0) {
            dayData.sleepIssues.forEach(symptom => {
                allSymptoms.push(symptom);
                
                // –°–æ–∑–¥–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–∏–º–ø—Ç–æ–º–∞ —Å–Ω–∞
                const sleepRecommendations = {
                    'insomnia': {
                        title: 'Insomnia',
                        description: 'For insomnia, establish a consistent bedtime routine and avoid screens 1 hour before sleep.',
                        symptoms: ['insomnia']
                    },
                    'early-wakeup': {
                        title: 'Early Wakeup',
                        description: 'For early awakenings, try going to bed later or using blackout curtains.',
                        symptoms: ['early-wakeup']
                    },
                    'fragmented-sleep': {
                        title: 'Fragmented Sleep',
                        description: 'Avoid fluids before bed and reduce noise disruptions for better sleep continuity.',
                        symptoms: ['fragmented-sleep']
                    },
                    'difficulty-falling-asleep': {
                        title: 'Difficulty Falling Asleep',
                        description: 'Practice relaxation techniques and create a calming pre-sleep routine.',
                        symptoms: ['difficulty-falling-asleep']
                    },
                    'non-restorative-sleep': {
                        title: 'Non-Restorative Sleep',
                        description: 'Ensure your sleep environment is comfortable and free from disruptions.',
                        symptoms: ['non-restorative-sleep']
                    },
                    'daytime-sleepiness': {
                        title: 'Daytime Sleepiness',
                        description: 'Maintain consistent sleep schedule and avoid caffeine in the afternoon.',
                        symptoms: ['daytime-sleepiness']
                    }
                };
                
                if (sleepRecommendations[symptom]) {
                    recommendations.push(sleepRecommendations[symptom]);
                }
            });
        }
        
        // –ï—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω "poor-sleep" –Ω–æ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
        if (dayData.sleepQuality === 'poor-sleep' && 
            (!dayData.sleepIssues || dayData.sleepIssues.length === 0)) {
            allSymptoms.push('poor-sleep');
            recommendations.push({
                title: 'Sleep Quality Improvement',
                description: 'Improve sleep quality with a dark, quiet room and comfortable temperature.',
                symptoms: ['poor-sleep']
            });
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–º–ø—Ç–æ–º—ã –æ–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏—è
        if (dayData.waterIntake === 'too-little') allSymptoms.push('dehydration');
        if (dayData.dehydrationSymptoms && dayData.dehydrationSymptoms.length > 0) {
            dayData.dehydrationSymptoms.forEach(symptom => {
                allSymptoms.push(symptom);
                
                const dehydrationRecommendations = {
                    'headache': {
                        title: 'Headache Relief',
                        description: 'Stay hydrated, reduce screen time, and practice relaxation techniques.',
                        symptoms: ['headache']
                    },
                    'fatigue': {
                        title: 'Energy Management',
                        description: 'Ensure adequate sleep, balanced nutrition, and regular light exercise.',
                        symptoms: ['fatigue']
                    },
                    'dry-skin-mucous': {
                        title: 'Skin & Mucous Hydration',
                        description: 'Increase water intake and use moisturizers for dry skin.',
                        symptoms: ['dry-skin-mucous']
                    },
                    'poor-concentration': {
                        title: 'Focus Improvement',
                        description: 'Stay hydrated and take regular breaks during work.',
                        symptoms: ['poor-concentration']
                    }
                };
                
                if (dehydrationRecommendations[symptom]) {
                    recommendations.push(dehydrationRecommendations[symptom]);
                }
            });
        }
        
        // –ï—Å–ª–∏ –±—ã–ª–æ –≤—ã–±—Ä–∞–Ω–æ "too-little" –Ω–æ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
        if (dayData.waterIntake === 'too-little' && 
            (!dayData.dehydrationSymptoms || dayData.dehydrationSymptoms.length === 0)) {
            allSymptoms.push('dehydration');
            recommendations.push({
                title: 'Hydration',
                description: 'Drink at least 2 liters of water daily. Use reminders to stay hydrated.',
                symptoms: ['dehydration']
            });
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–º–ø—Ç–æ–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
        if (dayData.mood && dayData.mood <= 4) allSymptoms.push('low-mood');
        if (dayData.moodRelated && dayData.moodRelated.length > 0) {
            dayData.moodRelated.forEach(symptom => {
                allSymptoms.push(symptom);
                
                const moodRecommendations = {
                    'stress': {
                        title: 'Stress Management',
                        description: 'Practice mindfulness, deep breathing, or take short breaks.',
                        symptoms: ['stress']
                    },
                    'anxiety': {
                        title: 'Anxiety Relief',
                        description: 'Grounding techniques and focused breathing can help manage anxiety.',
                        symptoms: ['anxiety']
                    },
                    'apathy': {
                        title: 'Motivation Boost',
                        description: 'Set small achievable goals and engage in enjoyable activities.',
                        symptoms: ['apathy']
                    },
                    'depressive-episode': {
                        title: 'Depressive Episode Support',
                        description: 'Reach out to supportive people and consider professional help.',
                        symptoms: ['depressive-episode']
                    },
                    'irritability': {
                        title: 'Emotional Regulation',
                        description: 'Practice deep breathing and identify triggers for irritability.',
                        symptoms: ['irritability']
                    },
                    'social-isolation': {
                        title: 'Social Connection',
                        description: 'Maintain social connections and engage in community activities.',
                        symptoms: ['social-isolation']
                    },
                    'mood-swings': {
                        title: 'Mood Stability',
                        description: 'Track mood patterns and practice emotional regulation techniques.',
                        symptoms: ['mood-swings']
                    }
                };
                
                if (moodRecommendations[symptom]) {
                    recommendations.push(moodRecommendations[symptom]);
                }
            });
        }
        
        // –ï—Å–ª–∏ –±—ã–ª–æ –Ω–∏–∑–∫–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–æ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
        if (dayData.mood && dayData.mood <= 4 && 
            (!dayData.moodRelated || dayData.moodRelated.length === 0)) {
            allSymptoms.push('low-mood');
            recommendations.push({
                title: 'Mood Management',
                description: 'Practice mindfulness and maintain social connections for better emotional wellbeing.',
                symptoms: ['low-mood']
            });
        }
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–∏–º–ø—Ç–æ–º—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        if (dayData.activityLevel && (dayData.activityLevel <= 3 || dayData.activityLevel >= 8)) {
            allSymptoms.push(dayData.activityLevel <= 3 ? 'low-activity' : 'high-activity');
        }
        
        if (dayData.activityIssues && dayData.activityIssues.length > 0) {
            dayData.activityIssues.forEach(symptom => {
                allSymptoms.push(symptom);
                
                const activityRecommendations = {
                    'sedentary-day': {
                        title: 'Sedentary Lifestyle',
                        description: 'Incorporate light movement throughout the day.',
                        symptoms: ['sedentary-day']
                    },
                    'overtraining': {
                        title: 'Overtraining Recovery',
                        description: 'Balance exercise with adequate rest and recovery time.',
                        symptoms: ['overtraining']
                    },
                    'bad-mood': {
                        title: 'Activity & Mood Connection',
                        description: 'Light exercise can improve mood and energy levels.',
                        symptoms: ['bad-mood']
                    },
                    'reduced-metabolism': {
                        title: 'Metabolic Health',
                        description: 'Regular physical activity supports healthy metabolism.',
                        symptoms: ['reduced-metabolism']
                    },
                    'muscle-weakness': {
                        title: 'Muscle Strength',
                        description: 'Incorporate light strength exercises for muscle health.',
                        symptoms: ['muscle-weakness']
                    },
                    'increased-stress': {
                        title: 'Stress Management',
                        description: 'Moderate exercise can help manage stress levels.',
                        symptoms: ['increased-stress']
                    },
                    'chronic-fatigue': {
                        title: 'Chronic Fatigue Management',
                        description: 'Balance activity with rest for chronic fatigue.',
                        symptoms: ['chronic-fatigue']
                    }
                };
                
                if (activityRecommendations[symptom]) {
                    recommendations.push(activityRecommendations[symptom]);
                }
            });
        }
        
        // –ï—Å–ª–∏ –±—ã–ª–∞ –Ω–∏–∑–∫–∞—è/–≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–æ –Ω–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤
        if (dayData.activityLevel && (dayData.activityLevel <= 3 || dayData.activityLevel >= 8) &&
            (!dayData.activityIssues || dayData.activityIssues.length === 0)) {
            const activityType = dayData.activityLevel <= 3 ? 'low-activity' : 'high-activity';
            recommendations.push({
                title: activityType === 'low-activity' ? 'Low Activity Level' : 'High Activity Level',
                description: 'Aim for moderate daily activity (30-60 minutes).',
                symptoms: [activityType]
            });
        }
        
        console.log('Collected symptoms:', allSymptoms);
        console.log('Created recommendations:', recommendations);
        
        // –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ü–†–ê–í–ò–õ–¨–ù–û–ú —Ñ–æ—Ä–º–∞—Ç–µ
        let message = `üìã Daily Recommendations - ${date}\n\n`;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤
        if (allSymptoms.length > 0) {
            message += `Total symptoms: ${allSymptoms.length}\n`;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–∏–º–ø—Ç–æ–º–æ–≤
        if (allSymptoms.length > 0) {
            message += `Symptoms: ${allSymptoms.join(', ')}\n\n`;
        } else {
            message += `No specific symptoms tracked\n\n`;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ "1. Title: Description"
        if (recommendations.length > 0) {
            recommendations.forEach((rec, index) => {
                message += `${index + 1}. ${rec.title}: ${rec.description}\n`;
            });
        } else {
            message += "1. General Health: Keep tracking your daily habits for better health insights.\n";
        }
        
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const notification = {
            id: Date.now(),
            type: 'symptom_recommendations',
            message: message,
            sent_at: new Date().toISOString(),
            read: false
        };
        
        console.log('Notification message created:', notification.message);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        const currentNotifications = JSON.parse(localStorage.getItem('health_tracker_notifications') || '[]');
        currentNotifications.unshift(notification);
        localStorage.setItem('health_tracker_notifications', JSON.stringify(currentNotifications));
        
        console.log('‚úÖ Notification saved to localStorage');
        return true;
    } catch (error) {
        console.error('‚ùå Error creating notification:', error);
        return false;
    }
}
// =================== HEALTH SCORE –§–£–ù–ö–¶–ò–ò ===================
function calculateSleepScore(sleepHours, sleepQuality, sleepIssues) {
    let baseScore = 0;

    if (!sleepHours) return 0;

    if (sleepHours >= 7 && sleepHours <= 8) {
        baseScore = HEALTH_SCORE_CONFIG.sleep.scores.optimal;
    } else if ((sleepHours >= 6 && sleepHours < 7) || (sleepHours > 8 && sleepHours <= 9)) {
        baseScore = HEALTH_SCORE_CONFIG.sleep.scores.good;
    } else if ((sleepHours >= 5 && sleepHours < 6) || (sleepHours > 9 && sleepHours <= 10)) {
        baseScore = HEALTH_SCORE_CONFIG.sleep.scores.fair;
    } else if (sleepHours >= 4 && sleepHours < 5) {
        baseScore = HEALTH_SCORE_CONFIG.sleep.scores.poor;
    } else {
        baseScore = HEALTH_SCORE_CONFIG.sleep.scores.veryPoor;
    }

    if (sleepQuality === 'poor-sleep') {
        baseScore -= HEALTH_SCORE_CONFIG.sleep.poorSleepPenalty;
    }

    if (sleepIssues && sleepIssues.length > 0) {
        const symptomPenalty = sleepIssues.length * HEALTH_SCORE_CONFIG.sleep.symptomPenalty;
        baseScore -= symptomPenalty;
    }

    return Math.max(0, Math.min(100, baseScore));
}

function calculateWaterScore(waterIntake, dehydrationSymptoms) {
    if (!waterIntake) return 0;
    let baseScore = HEALTH_SCORE_CONFIG.water.scores[waterIntake] || 50;
    if (dehydrationSymptoms && dehydrationSymptoms.length > 0) {
        const symptomPenalty = dehydrationSymptoms.length * HEALTH_SCORE_CONFIG.water.symptomPenalty;
        baseScore -= symptomPenalty;
    }
    return Math.max(0, Math.min(100, baseScore));
}

function calculateMoodScore(mood, moodRelated) {
    if (!mood) return 0;
    let baseScore = HEALTH_SCORE_CONFIG.mood.scores[mood] || 50;
    if (mood <= 4) baseScore -= HEALTH_SCORE_CONFIG.mood.lowMoodPenalty;
    if (moodRelated && moodRelated.length > 0) {
        const symptomPenalty = moodRelated.length * HEALTH_SCORE_CONFIG.mood.symptomPenalty;
        baseScore -= symptomPenalty;
    }
    return Math.max(0, Math.min(100, baseScore));
}

function calculateActivityScore(activityLevel, activityIssues) {
    if (!activityLevel) return 0;
    let baseScore = HEALTH_SCORE_CONFIG.activity.scores[activityLevel] || 50;
    if (activityLevel <= 3) baseScore -= HEALTH_SCORE_CONFIG.activity.lowActivityPenalty;
    if (activityLevel >= 8) baseScore -= HEALTH_SCORE_CONFIG.activity.highActivityPenalty;
    if (activityIssues && activityIssues.length > 0) {
        const symptomPenalty = activityIssues.length * HEALTH_SCORE_CONFIG.activity.symptomPenalty;
        baseScore -= symptomPenalty;
    }
    return Math.max(0, Math.min(100, baseScore));
}

function calculateHealthScore(dayData) {
    const sleepScore = calculateSleepScore(
        dayData.sleepHours,
        dayData.sleepQuality,
        dayData.sleepIssues
    );

    const waterScore = calculateWaterScore(
        dayData.waterIntake,
        dayData.dehydrationSymptoms
    );

    const moodScore = calculateMoodScore(
        dayData.mood,
        dayData.moodRelated
    );

    const activityScore = calculateActivityScore(
        dayData.activityLevel,
        dayData.activityIssues
    );

    const weightedSleep = sleepScore * (HEALTH_SCORE_CONFIG.sleep.weight / 100);
    const weightedWater = waterScore * (HEALTH_SCORE_CONFIG.water.weight / 100);
    const weightedMood = moodScore * (HEALTH_SCORE_CONFIG.mood.weight / 100);
    const weightedActivity = activityScore * (HEALTH_SCORE_CONFIG.activity.weight / 100);

    const overallScore = Math.round(weightedSleep + weightedWater + weightedMood + weightedActivity);

    return {
        overallScore,
        categories: [
            {
                name: 'Sleep',
                score: sleepScore,
                weight: HEALTH_SCORE_CONFIG.sleep.weight,
                description: getSleepDescription(dayData.sleepHours, dayData.sleepQuality, dayData.sleepIssues),
                icon: 'üò¥'
            },
            {
                name: 'Water',
                score: waterScore,
                weight: HEALTH_SCORE_CONFIG.water.weight,
                description: getWaterDescription(dayData.waterIntake, dayData.dehydrationSymptoms),
                icon: 'üíß'
            },
            {
                name: 'Mood',
                score: moodScore,
                weight: HEALTH_SCORE_CONFIG.mood.weight,
                description: getMoodDescription(dayData.mood, dayData.moodRelated),
                icon: 'üòä'
            },
            {
                name: 'Activity',
                score: activityScore,
                weight: HEALTH_SCORE_CONFIG.activity.weight,
                description: getActivityDescription(dayData.activityLevel, dayData.activityIssues),
                icon: 'üèÉ'
            }
        ],
        verdict: getVerdict(overallScore)
    };
}

function getSleepDescription(hours, quality, issues) {
    let desc = hours ? `${hours} hours` : 'No data';
    if (quality === 'poor-sleep') desc += ' (poor quality)';
    if (issues && issues.length > 0) desc += `, ${issues.length} issue(s)`;
    return desc;
}

function getWaterDescription(intake, symptoms) {
    let desc = intake ? intake.replace('-', ' ') : 'No data';
    if (symptoms && symptoms.length > 0) desc += `, ${symptoms.length} symptom(s)`;
    return desc;
}

function getMoodDescription(mood, related) {
    let desc = mood ? `${mood}/10` : 'No data';
    if (related && related.length > 0) desc += `, ${related.length} issue(s)`;
    return desc;
}

function getActivityDescription(level, issues) {
    let desc = level ? `${level}/10` : 'No data';
    if (issues && issues.length > 0) desc += `, ${issues.length} issue(s)`;
    return desc;
}

function getVerdict(score) {
    if (score >= 90) return { level: 'Excellent', description: 'Outstanding health habits!', color: '#4CAF50', emoji: 'üåü' };
    else if (score >= 80) return { level: 'Great', description: 'Very healthy lifestyle!', color: '#8BC34A', emoji: 'üí™' };
    else if (score >= 70) return { level: 'Good', description: 'Solid health metrics.', color: '#FFC107', emoji: 'üëå' };
    else if (score >= 60) return { level: 'Fair', description: 'Room for improvement.', color: '#FF9800', emoji: '‚öñÔ∏è' };
    else if (score >= 50) return { level: 'Needs Work', description: 'Focus on healthier choices.', color: '#F44336', emoji: 'üìâ' };
    else return { level: 'Poor', description: 'Significant improvements needed.', color: '#D32F2F', emoji: '‚ö†Ô∏è' };
}

function getScoreColor(score) {
    if (score >= 80) return 'var(--excellent-color)';
    if (score >= 60) return 'var(--good-color)';
    if (score >= 40) return 'var(--fair-color)';
    return 'var(--poor-color)';
}

// =================== UI –§–£–ù–ö–¶–ò–ò ===================
let currentDate = new Date();
let currentYear = currentDate.getFullYear();
let currentMonth = currentDate.getMonth();
let selectedDay = null;

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
let currentMonthYear, calendarDays, dayModal, modalDayTitle, closeModal;
let sleepSlider, sleepValueDisplay, sleepQualityButtons;
let waterIntakeButtons, moodSlider, moodValueDisplay, activitySlider, activityValueDisplay;
let dayNotes, saveDayBtn;
let sleepIssuesSection, dehydrationSection, moodRelatedSection, activityIssuesSection;
let sleepIssuesButtons, dehydrationButtons, moodRelatedButtons, activityIssuesButtons;
let prevMonthBtn, nextMonthBtn;

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    const toastContainer = document.getElementById('toast-container');
    toastContainer.appendChild(toast);
    setTimeout(() => {
        if (toast.parentNode === toastContainer) {
            toastContainer.removeChild(toast);
        }
    }, 3000);
}

async function updateStreakDisplay() {
    const streakFire = document.getElementById('streak-fire');
    const streakCount = document.getElementById('streak-count');

    const streakData = getStreakFromStorage();
    const currentStreak = streakData.currentStreak || 0;

    streakCount.textContent = currentStreak;
    streakCount.style.display = 'block';

    if (currentStreak > 0) {
        streakFire.className = 'streak-fire active';
        streakFire.style.animation = 'flame-pulse 0.5s ease-in-out';
        setTimeout(() => {
            streakFire.style.animation = '';
        }, 500);
    } else {
        streakFire.className = 'streak-fire inactive';
    }
}

function updateHealthScoreDisplay(healthScoreData) {
    const healthScoreElement = document.getElementById('health-score');
    const healthLabelElement = document.getElementById('health-label');
    const ringProgress = document.getElementById('ring-progress');
    const verdictElement = document.getElementById('health-verdict');
    const detailsContainer = document.getElementById('health-score-details');

    if (!healthScoreData) {
        healthScoreElement.textContent = '-';
        healthLabelElement.textContent = 'No data';
        verdictElement.textContent = 'Save day data to see your health score';
        ringProgress.style.strokeDashoffset = '565';
        displayEmptyHealthScore();
        return;
    }

    const { overallScore, categories, verdict } = healthScoreData;

    healthScoreElement.textContent = overallScore;
    healthLabelElement.innerHTML = `${verdict.emoji} ${verdict.level}`;

    const circumference = 2 * Math.PI * 90;
    const offset = circumference - (overallScore / 100) * circumference;

    setTimeout(() => {
        ringProgress.style.strokeDashoffset = offset;
    }, 100);

    verdictElement.textContent = verdict.description;
    verdictElement.style.color = verdict.color;

    let detailsHTML = '';
    categories.forEach(category => {
        const categoryColor = getScoreColor(category.score);

        detailsHTML += `
            <div class="score-category ${category.name.toLowerCase()}-category">
                <div class="category-header">
                    <div class="category-name">
                        <span class="category-icon">${category.icon}</span>
                        ${category.name} (${category.weight}%)
                    </div>
                    <div class="category-score">${category.score}</div>
                </div>
                <div class="score-bar">
                    <div class="score-fill" style="width: ${category.score}%; background-color: ${categoryColor};"></div>
                </div>
                <div class="score-description">${category.description}</div>
            </div>
        `;
    });

    detailsContainer.innerHTML = detailsHTML;

    setTimeout(() => {
        const scoreFills = document.querySelectorAll('.score-fill');
        scoreFills.forEach(fill => {
            const width = fill.style.width;
            fill.style.width = '0%';
            setTimeout(() => {
                fill.style.width = width;
            }, 100);
        });
    }, 300);
}

function displayEmptyHealthScore() {
    const categories = [
        { name: 'Sleep', weight: 40, color: '#2196F3', description: 'Track your sleep', icon: 'üò¥' },
        { name: 'Water', weight: 20, color: '#00BCD4', description: 'Record water intake', icon: 'üíß' },
        { name: 'Activity', weight: 20, color: '#FF9800', description: 'Log activity level', icon: 'üèÉ' },
        { name: 'Mood', weight: 20, color: '#9C27B0', description: 'Track your mood', icon: 'üòä' }
    ];

    let detailsHTML = '';
    categories.forEach(category => {
        detailsHTML += `
            <div class="score-category ${category.name.toLowerCase()}-category">
                <div class="category-header">
                    <div class="category-name">
                        <span class="category-icon">${category.icon}</span>
                        ${category.name} (${category.weight}%)
                    </div>
                    <div class="category-score">-</div>
                </div>
                <div class="score-bar">
                    <div class="score-fill" style="width: 0%; background-color: ${category.color};"></div>
                </div>
                <div class="score-description">${category.description}</div>
            </div>
        `;
    });

    document.getElementById('health-score-details').innerHTML = detailsHTML;
}

async function loadHealthScore() {
    const healthScoreElement = document.getElementById('health-score');
    const healthLabelElement = document.getElementById('health-label');
    const ringProgress = document.getElementById('ring-progress');
    const verdictElement = document.getElementById('health-verdict');

    try {
        healthScoreElement.textContent = '...';
        healthLabelElement.textContent = 'Calculating...';
        verdictElement.textContent = '';

        const healthScoreData = await calculateCurrentHealthScore();

        if (healthScoreData) {
            updateHealthScoreDisplay(healthScoreData);
        } else {
            healthScoreElement.textContent = '-';
            healthLabelElement.textContent = 'No data';
            verdictElement.textContent = 'Save today\'s data to see your health score';
            ringProgress.style.strokeDashoffset = '565';
            displayEmptyHealthScore();
        }
    } catch (error) {
        console.error('Error loading Health Score:', error);
        healthScoreElement.textContent = '-';
        healthLabelElement.textContent = 'Error';
        verdictElement.textContent = 'Failed to calculate health score';
        ringProgress.style.strokeDashoffset = '565';
        displayEmptyHealthScore();
    }
}

async function calculateCurrentHealthScore() {
    try {
        let dayData = {
            sleepHours: parseFloat(sleepSlider?.value) || null,
            sleepQuality: getSelectedValue(sleepQualityButtons) || '',
            waterIntake: getSelectedValue(waterIntakeButtons) || null,
            mood: parseInt(moodSlider?.value) || null,
            activityLevel: parseInt(activitySlider?.value) || null,
            sleepIssues: getSelectedValues(sleepIssuesButtons) || [],
            dehydrationSymptoms: getSelectedValues(dehydrationButtons) || [],
            moodRelated: getSelectedValues(moodRelatedButtons) || [],
            activityIssues: getSelectedValues(activityIssuesButtons) || []
        };

        const today = new Date().toISOString().split('T')[0];
        const savedDayData = getDayFromStorage(today);
        
        if (savedDayData) {
            dayData = { ...savedDayData, ...dayData };
        }

        return calculateHealthScore(dayData);
    } catch (error) {
        console.error('Error calculating Health Score:', error);
        return null;
    }
}

function getSelectedValue(buttonGroup) {
    const selectedButton = buttonGroup?.querySelector('.notion-button.selected');
    return selectedButton ? selectedButton.dataset.value : null;
}

function getSelectedValues(buttonGroup) {
    const selectedButtons = buttonGroup?.querySelectorAll('.notion-button.selected') || [];
    return Array.from(selectedButtons).map(btn => btn.dataset.value);
}

async function renderCalendar() {
    if (!currentMonthYear) return;

    currentMonthYear.textContent = new Date(currentYear, currentMonth).toLocaleDateString('en-US', { 
        month: 'long', 
        year: 'numeric' 
    });
    calendarDays.innerHTML = '';

    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

    for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day empty';
        emptyDay.style.visibility = 'hidden';
        calendarDays.appendChild(emptyDay);
    }

    const monthData = getDaysFromStorage();

    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.dataset.day = day;
        dayElement.dataset.month = currentMonth + 1;
        dayElement.dataset.year = currentYear;

        const dayNumber = document.createElement('div');
        dayNumber.className = 'calendar-day-number';
        dayNumber.textContent = day;
        dayElement.appendChild(dayNumber);

        const dateKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayData = monthData[dateKey];

        const hasData = dayData && (
            dayData.sleepHours !== undefined ||
            dayData.mood !== undefined ||
            dayData.activityLevel !== undefined ||
            dayData.waterIntake !== undefined
        );

        if (hasData) {
            dayElement.classList.add('saved');
            const savedIndicator = document.createElement('span');
            savedIndicator.className = 'saved-day-checkmark';
            savedIndicator.textContent = '‚úì';
            savedIndicator.title = 'Day saved';
            dayElement.appendChild(savedIndicator);
        }

        dayElement.addEventListener('click', (e) => {
            e.stopPropagation();
            selectedDay = day;
            openDayModal(currentYear, currentMonth, day);
        });

        const today = new Date();
        if (currentYear === today.getFullYear() &&
            currentMonth === today.getMonth() &&
            day === today.getDate()) {
            dayElement.classList.add('today');
        }

        calendarDays.appendChild(dayElement);
    }
}

function handleButtonClick(event, isMultiSelect) {
    const clickedButton = event.target.closest('.notion-button');
    if (!clickedButton) return;
    const buttonGroup = clickedButton.parentElement;
    const buttons = buttonGroup.querySelectorAll('.notion-button');
    if (!isMultiSelect) buttons.forEach(btn => btn.classList.remove('selected'));
    clickedButton.classList.toggle('selected');
}

function checkSleepCondition() {
    const poorSleepSelected = sleepQualityButtons.querySelector('[data-value="poor-sleep"]')?.classList.contains('selected') || false;
    sleepIssuesSection.style.display = poorSleepSelected ? 'block' : 'none';
}

function checkWaterCondition() {
    const tooLittleSelected = waterIntakeButtons.querySelector('[data-value="too-little"]')?.classList.contains('selected') || false;
    dehydrationSection.style.display = tooLittleSelected ? 'block' : 'none';
}

function checkMoodCondition() {
    const moodValue = parseInt(moodSlider.value);
    moodRelatedSection.style.display = moodValue <= 4 ? 'block' : 'none';
}

function checkActivityCondition() {
    const activityValue = parseInt(activitySlider.value);
    activityIssuesSection.style.display = (activityValue <= 3 || activityValue >= 8) ? 'block' : 'none';
}

async function openDayModal(year, month, day) {
    try {
        const date = new Date(year, month, day);
        modalDayTitle.textContent = date.toLocaleDateString('en-US', {
            weekday: 'long',
            month: 'long',
            day: 'numeric',
            year: 'numeric'
        });

        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayData = getDayFromStorage(dateStr);

        sleepSlider.value = dayData ? dayData.sleepHours || 7 : 7;
        sleepValueDisplay.textContent = parseFloat(sleepSlider.value).toFixed(1) + ' hrs';
        moodSlider.value = dayData ? dayData.mood || 5 : 5;
        moodValueDisplay.textContent = moodSlider.value;
        activitySlider.value = dayData ? dayData.activityLevel || 5 : 5;
        activityValueDisplay.textContent = activitySlider.value;
        dayNotes.value = dayData ? dayData.notes || '' : '';

        const allButtons = document.querySelectorAll('.notion-button');
        allButtons.forEach(btn => btn.classList.remove('selected'));

        if (dayData) {
            if (dayData.sleepQuality) {
                const sleepBtn = sleepQualityButtons.querySelector(`[data-value="${dayData.sleepQuality}"]`);
                if (sleepBtn) sleepBtn.classList.add('selected');
            }
            if (dayData.waterIntake) {
                const waterBtn = waterIntakeButtons.querySelector(`[data-value="${dayData.waterIntake}"]`);
                if (waterBtn) waterBtn.classList.add('selected');
            }
            if (dayData.sleepIssues && Array.isArray(dayData.sleepIssues)) {
                dayData.sleepIssues.forEach(issue => {
                    const issueBtn = sleepIssuesButtons.querySelector(`[data-value="${issue}"]`);
                    if (issueBtn) issueBtn.classList.add('selected');
                });
            }
            if (dayData.dehydrationSymptoms && Array.isArray(dayData.dehydrationSymptoms)) {
                dayData.dehydrationSymptoms.forEach(symptom => {
                    const symptomBtn = dehydrationButtons.querySelector(`[data-value="${symptom}"]`);
                    if (symptomBtn) symptomBtn.classList.add('selected');
                });
            }
            if (dayData.moodRelated && Array.isArray(dayData.moodRelated)) {
                dayData.moodRelated.forEach(mood => {
                    const moodBtn = moodRelatedButtons.querySelector(`[data-value="${mood}"]`);
                    if (moodBtn) moodBtn.classList.add('selected');
                });
            }
            if (dayData.activityIssues && Array.isArray(dayData.activityIssues)) {
                dayData.activityIssues.forEach(issue => {
                    const issueBtn = activityIssuesButtons.querySelector(`[data-value="${issue}"]`);
                    if (issueBtn) issueBtn.classList.add('selected');
                });
            }
        }

        checkSleepCondition();
        checkWaterCondition();
        checkMoodCondition();
        checkActivityCondition();

        dayModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    } catch (error) {
        console.error('Error opening day modal:', error);
        showToast('Error opening day details');
    }
}

async function saveDayData() {
    if (!selectedDay) return;

    const dayData = {
        sleepHours: parseFloat(sleepSlider.value),
        sleepQuality: getSelectedValue(sleepQualityButtons),
        waterIntake: getSelectedValue(waterIntakeButtons),
        mood: parseInt(moodSlider.value),
        activityLevel: parseInt(activitySlider.value),
        notes: dayNotes.value,
        sleepIssues: getSelectedValues(sleepIssuesButtons),
        dehydrationSymptoms: getSelectedValues(dehydrationButtons),
        moodRelated: getSelectedValues(moodRelatedButtons),
        activityIssues: getSelectedValues(activityIssuesButtons),
        negativeFactors: []
    };

    const negativeButtons = document.querySelectorAll('.notion-button[data-negative="true"].selected');
    negativeButtons.forEach(btn => dayData.negativeFactors.push(btn.dataset.value));

    try {
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(selectedDay).padStart(2, '0')}`;

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ–Ω—å
        if (saveDayToStorage(dateStr, dayData)) {
            // –û–±–Ω–æ–≤–ª—è–µ–º streak
            const streakResult = updateStreakInStorage(dateStr);
            
            // –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–Ω—è
            console.log('Saving day, creating notification...');
            const notificationCreated = createNotificationForDay(dayData, dateStr);
            console.log('Notification created:', notificationCreated);

            dayModal.style.display = 'none';
            document.body.style.overflow = '';

            await renderCalendar();
            await updateStreakDisplay();
            await loadHealthScore();

            let streakMessage = '';
            if (streakResult.streakIncremented) {
                streakMessage = `Streak: ${streakResult.currentStreak} days!`;
            }

            if (streakMessage) {
                showToast(streakMessage);
            } else {
                showToast('Day saved successfully!');
            }
        } else {
            throw new Error('Failed to save day data');
        }
    } catch (error) {
        console.error('Error saving day:', error);
        showToast('Error: ' + error.message);
    }
}

// =================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===================
document.addEventListener('DOMContentLoaded', function () {
    // –ü–æ–ª—É—á–∞–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    currentMonthYear = document.getElementById('current-month-year');
    calendarDays = document.getElementById('calendar-days');
    dayModal = document.getElementById('day-modal');
    modalDayTitle = document.getElementById('modal-day-title');
    closeModal = document.querySelector('.close-modal');

    sleepSlider = document.getElementById('sleep-slider');
    sleepValueDisplay = document.getElementById('sleep-value');
    sleepQualityButtons = document.getElementById('sleep-quality-buttons');

    waterIntakeButtons = document.getElementById('water-intake-buttons');
    moodSlider = document.getElementById('mood-slider');
    moodValueDisplay = document.getElementById('mood-value');
    activitySlider = document.getElementById('activity-slider');
    activityValueDisplay = document.getElementById('activity-value');
    dayNotes = document.getElementById('day-notes');
    saveDayBtn = document.getElementById('save-day-btn');

    sleepIssuesSection = document.getElementById('sleep-issues-section');
    dehydrationSection = document.getElementById('dehydration-section');
    moodRelatedSection = document.getElementById('mood-related-section');
    activityIssuesSection = document.getElementById('activity-issues-section');

    sleepIssuesButtons = document.getElementById('sleep-issues-buttons');
    dehydrationButtons = document.getElementById('dehydration-buttons');
    moodRelatedButtons = document.getElementById('mood-related-buttons');
    activityIssuesButtons = document.getElementById('activity-issues-buttons');

    prevMonthBtn = document.getElementById('prev-month');
    nextMonthBtn = document.getElementById('next-month');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateStreakDisplay();
    renderCalendar();
    loadHealthScore();

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π
    closeModal.addEventListener('click', () => {
        dayModal.style.display = 'none';
        document.body.style.overflow = '';
    });

    sleepSlider.addEventListener('input', () => {
        sleepValueDisplay.textContent = parseFloat(sleepSlider.value).toFixed(1) + ' hrs';
    });

    moodSlider.addEventListener('input', () => {
        moodValueDisplay.textContent = moodSlider.value;
        checkMoodCondition();
    });

    activitySlider.addEventListener('input', () => {
        activityValueDisplay.textContent = activitySlider.value;
        checkActivityCondition();
    });

    sleepQualityButtons.addEventListener('click', (e) => {
        handleButtonClick(e, false);
        checkSleepCondition();
    });

    waterIntakeButtons.addEventListener('click', (e) => {
        handleButtonClick(e, false);
        checkWaterCondition();
    });

    [sleepIssuesButtons, dehydrationButtons, moodRelatedButtons, activityIssuesButtons]
        .forEach(group => {
            if (group) {
                group.addEventListener('click', (e) => handleButtonClick(e, true));
            }
        });

    saveDayBtn.addEventListener('click', async () => {
        await saveDayData();
    });

    window.addEventListener('click', (e) => {
        if (e.target === dayModal) {
            dayModal.style.display = 'none';
            document.body.style.overflow = '';
        }
    });

    prevMonthBtn.addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        renderCalendar();
    });

    nextMonthBtn.addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar();
    });

    // Health Score —Å–æ–±—ã—Ç–∏—è
    const healthScoreTitle = document.getElementById('health-score-title');
    const healthScoreToggle = document.getElementById('health-score-toggle');
    const healthScoreDetails = document.getElementById('health-score-details');

    if (healthScoreTitle && healthScoreDetails) {
        const isCollapsed = localStorage.getItem('healthScoreDetailsCollapsed') === 'true';
        if (isCollapsed) {
            healthScoreDetails.classList.add('collapsed');
            healthScoreToggle.classList.add('collapsed');
        }

        healthScoreTitle.addEventListener('click', function () {
            const isCollapsed = healthScoreDetails.classList.contains('collapsed');
            if (isCollapsed) {
                healthScoreDetails.classList.remove('collapsed');
                healthScoreToggle.classList.remove('collapsed');
                localStorage.setItem('healthScoreDetailsCollapsed', 'false');
            } else {
                healthScoreDetails.classList.add('collapsed');
                healthScoreToggle.classList.add('collapsed');
                localStorage.setItem('healthScoreDetailsCollapsed', 'true');
            }
        });
    }

    // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ Health Score
    if (healthScoreTitle) {
        healthScoreTitle.addEventListener('dblclick', () => {
            loadHealthScore();
            showToast('Health Score recalculated');
        });
    }
});
    </script>
    
</body>
</html>





