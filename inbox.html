<!doctype html>
<html lang="en">
<head>
    <link rel="icon" href="PNGs/favicon5.ico">
    <meta charset="UTF-8">
    <title>Notification History</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.1/aos.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            padding: 20px;
            margin: 0;
            background: #0a0a0a;
            color: #f0f0f0;
            background-image: url('PNGs/pic2.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
        }

        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 24px;
            color: black;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
            font-weight: 700;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* SELECT ALL */
        .select-all-container {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ffffff;
            cursor: pointer;
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.3s ease;
            user-select: none;
        }

            .select-all-container:hover {
                background: rgba(255, 255, 255, 0.08);
                border-color: rgba(255, 255, 255, 0.15);
                transform: translateY(-1px);
            }

            .select-all-container label {
                cursor: pointer;
                font-weight: 600;
                font-size: 15px;
                color: #ffffff;
                transition: color 0.3s ease;
            }

        /* –°–∫—Ä—ã—Ç—ã–π —á–µ–∫–±–æ–∫—Å */
        #select-all-checkbox {
            display: none;
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —á–µ–∫–±–æ–∫—Å */
        .select-all-container .custom-checkbox {
            position: relative;
            width: 22px;
            height: 22px;
            border-radius: 7px;
            background: rgba(64, 156, 255, 0.1);
            border: 2px solid rgba(64, 156, 255, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .select-all-container:hover .custom-checkbox {
            border-color: rgba(64, 156, 255, 0.5);
            background: rgba(64, 156, 255, 0.15);
        }

        /* –ì–∞–ª–æ—á–∫–∞ */
        .select-all-container .custom-checkbox::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 6px;
            border-left: 2px solid transparent;
            border-bottom: 2px solid transparent;
            transform: rotate(-45deg);
            transition: all 0.3s ease;
            opacity: 0;
        }

        /* –í—ã–±—Ä–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
        #select-all-checkbox:checked + .custom-checkbox {
            background: linear-gradient(135deg, #409CFF, #2d87ff);
            border-color: #409CFF;
            box-shadow: 0 4px 15px rgba(64, 156, 255, 0.3);
        }

            #select-all-checkbox:checked + .custom-checkbox::after {
                border-color: white;
                opacity: 1;
            }

            /* –ê–Ω–∏–º–∞—Ü–∏—è –≥–∞–ª–æ—á–∫–∏ */
            #select-all-checkbox:checked + .custom-checkbox::after {
                animation: checkmark 0.3s ease forwards;
            }

        @keyframes checkmark {
            0% {
                opacity: 0;
                transform: rotate(-45deg) scale(0.5);
            }

            100% {
                opacity: 1;
                transform: rotate(-45deg) scale(1);
            }
        }

        /* –î–ª—è JavaScript */
        .custom-checkbox.checked {
            background: linear-gradient(135deg, #409CFF, #2d87ff);
            border-color: #409CFF;
            box-shadow: 0 4px 15px rgba(64, 156, 255, 0.3);
        }

            .custom-checkbox.checked::after {
                border-color: white;
                opacity: 1;
            }

        .delete-selected-btn {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

            .delete-selected-btn:hover {
                background: linear-gradient(135deg, #ff3838, #ff1e1e);
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
            }

            .delete-selected-btn.visible {
                display: block;
            }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            background: rgba(20, 20, 25, 0.85);
            backdrop-filter: blur(12px);
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.08);
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }

            .notification:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
                background: rgba(25, 25, 30, 0.9);
            }

            .notification.selected {
                background: rgba(30, 60, 90, 0.85);
                border-color: rgba(64, 156, 255, 0.3);
            }

        .notification-header-compact {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            gap: 12px;
        }

        .notification-title-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .notification-date-badge {
            background: rgba(64, 156, 255, 0.15);
            color: #409CFF;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            border: 1px solid rgba(64, 156, 255, 0.2);
        }

        .notification-symptoms-count {
            background: rgba(255, 107, 129, 0.15);
            color: #ff6b81;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        .notification-checkbox {
            transform: scale(1.1);
            accent-color: #409CFF;
            cursor: pointer;
            flex-shrink: 0;
        }

        /* –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ */
        .recommendations-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 12px 0;
        }

        .recommendation-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.07);
            border-radius: 12px;
            padding: 12px;
            transition: all 0.2s ease;
        }

            .recommendation-card:hover {
                background: rgba(255, 255, 255, 0.08);
                border-color: rgba(255, 255, 255, 0.12);
                transform: translateX(2px);
            }

        .recommendation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .recommendation-title {
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .recommendation-icon {
            color: #409CFF;
            font-size: 12px;
        }

        .recommendation-description {
            color: #b0b0b0;
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .symptom-buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .symptom-button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(64, 156, 255, 0.1);
            color: #409CFF;
            text-decoration: none;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid rgba(64, 156, 255, 0.2);
            cursor: pointer;
            white-space: nowrap;
        }

            .symptom-button:hover {
                background: rgba(64, 156, 255, 0.2);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(64, 156, 255, 0.15);
            }

        .notification-footer-compact {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            margin-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }

        .notification-time {
            color: #888;
            font-size: 11px;
            font-weight: 400;
        }

        .notification-actions-compact {
            display: flex;
            gap: 6px;
        }

        .delete-btn-compact {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.2);
            cursor: pointer;
            padding: 6px;
            border-radius: 8px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

            .delete-btn-compact:hover {
                background: rgba(255, 71, 87, 0.2);
                transform: scale(1.05);
            }

            .delete-btn-compact svg {
                width: 16px;
                height: 16px;
                fill: #ff6b81;
            }

        /* –ü—É—Å—Ç—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ */
        .no-recommendations {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            color: #888;
            font-size: 13px;
            border: 1px dashed rgba(255, 255, 255, 0.05);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(4px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
            display: none;
        }

        .modal {
            background: rgba(20, 20, 25, 0.95);
            backdrop-filter: blur(20px);
            padding: 28px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            max-width: 90%;
            width: 340px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

            .modal p {
                margin-bottom: 24px;
                font-size: 16px;
                line-height: 1.6;
                color: #ffffff;
                font-weight: 500;
            }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .modal button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            flex: 1;
            transition: all 0.3s ease;
        }

        .modal .cancel-btn {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

            .modal .cancel-btn:hover {
                background: rgba(255, 255, 255, 0.15);
                border-color: rgba(255, 255, 255, 0.3);
                transform: translateY(-2px);
            }

        .modal .confirm-btn {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

            .modal .confirm-btn:hover {
                background: linear-gradient(135deg, #ff3838, #ff1e1e);
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
            }

        .empty-state {
            text-align: center;
            color: #ffffff;
            padding: 60px 0;
            font-size: 18px;
            font-weight: 500;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #409CFF;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 600px) {
            body {
                padding: 16px;
            }

            h1 {
                font-size: 20px;
            }

            .header-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .select-all-container {
                padding: 8px 14px;
                gap: 10px;
            }

                .select-all-container label {
                    font-size: 14px;
                }

                .select-all-container .custom-checkbox {
                    width: 20px;
                    height: 20px;
                }

                    .select-all-container .custom-checkbox::after {
                        width: 9px;
                        height: 5px;
                    }

            .notification {
                padding: 14px;
                border-radius: 14px;
                margin-bottom: 10px;
            }

            .notification-header-compact {
                flex-wrap: wrap;
            }

            .notification-title-row {
                width: 100%;
                justify-content: space-between;
                margin-bottom: 8px;
            }

            .recommendation-card {
                padding: 10px;
            }

            .symptom-buttons-container {
                gap: 4px;
            }

            .symptom-button {
                padding: 5px 10px;
                font-size: 11px;
                flex-grow: 1;
                justify-content: center;
            }

            .notification-footer-compact {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .notification-actions-compact {
                align-self: flex-end;
            }

            .modal {
                padding: 20px;
                margin: 16px;
            }
        }

        .toast {
            background: rgba(20, 20, 25, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>

    <h1 data-aos="fade-down" style="font-size: 30px;">Notification History</h1>

    <div class="header-controls">
        <!-- SELECT ALL -->
        <div class="select-all-container" onclick="toggleSelectAllWrapper()">
            <input type="checkbox" id="select-all-checkbox">
            <div class="custom-checkbox"></div>
            <label for="select-all-checkbox">Select All</label>
        </div>
        <button id="delete-selected-btn" class="delete-selected-btn" onclick="showBulkDeleteConfirm()">Delete Selected</button>
    </div>

    <div id="loading-indicator" style="text-align: center; padding: 20px; display: none;">
        <div class="loading-spinner"></div>
        <div style="margin-top: 10px; color: #ffffff;">Loading notifications...</div>
    </div>

    <div id="history-list" data-aos="fade-up"></div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <p id="modalText">Are you sure you want to delete this notification?</p>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeModal()">Cancel</button>
                <button class="confirm-btn" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Bulk Delete Modal -->
    <div class="modal-overlay" id="bulkDeleteModal">
        <div class="modal">
            <p id="bulkDeleteText">Are you sure you want to delete selected notifications?</p>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeBulkDeleteModal()">Cancel</button>
                <button class="confirm-btn" onclick="confirmBulkDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- AOS JS -->
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const NOTIFICATIONS_STORAGE_KEY = 'health_tracker_notifications';
        const LAST_NOTIFICATION_ID_KEY = 'last_notification_id';

        // –ú–∞–ø–ø–∏–Ω–≥ —Å–∏–º–ø—Ç–æ–º–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ)
        const SYMPTOM_MAPPING = {
            'insomnia': 'insomnia.html',
            'poor-sleep': 'insomnia.html',
            'early-wakeup': 'early-awakenings.html',
            'early-awakening': 'early-awakenings.html',
            'fragmented-sleep': 'fragmented-sleep.html',
            'difficulty-falling-asleep': 'difficulty-falling-asleep.html',
            'non-restorative-sleep': 'non-restorative-sleep.html',
            'daytime-sleepiness': 'daytime-sleepiness.html',
            'headache': 'headache.html',
            'fatigue': 'fatigue.html',
            'dry-skin-mucous': 'dry-skin-mucous.html',
            'poor-concentration': 'poor-concentration.html',
            'stress': 'stress.html',
            'anxiety': 'anxiety.html',
            'apathy': 'apathy.html',
            'depressive-episode': 'depressive-episodes.html',
            'irritability': 'irritability.html',
            'social-isolation': 'social-isolation.html',
            'mood-swings': 'mood-swings.html',
            'sedentary-day': 'sedentary-day.html',
            'overtraining': 'overtraining.html',
            'bad-mood': 'bad-mood-activity.html',
            'reduced-metabolism': 'reduced-metabolism.html',
            'muscle-weakness': 'muscle-weakness.html',
            'increased-stress': 'increased-stress-activity.html',
            'chronic-fatigue': 'chronic-fatigue.html'
        };

        const SYMPTOM_GROUPING = {
            'insomnia.html': ['insomnia', 'poor-sleep'],
            'early-awakenings.html': ['early-wakeup', 'early-awakening', 'early awakenings'],
            'fragmented-sleep.html': ['fragmented-sleep', 'fragmented sleep'],
            'difficulty-falling-asleep.html': ['difficulty-falling-asleep', 'difficulty falling asleep'],
            'non-restorative-sleep.html': ['non-restorative-sleep', 'non restorative sleep'],
            'daytime-sleepiness.html': ['daytime-sleepiness', 'daytime sleepiness'],
            'headache.html': ['headache'],
            'fatigue.html': ['fatigue'],
            'dry-skin-mucous.html': ['dry-skin-mucous', 'dry skin mucous', 'dry skin'],
            'poor-concentration.html': ['poor-concentration', 'poor concentration'],
            'stress.html': ['stress'],
            'anxiety.html': ['anxiety'],
            'apathy.html': ['apathy'],
            'depressive-episodes.html': ['depressive-episode', 'depressive episode'],
            'irritability.html': ['irritability'],
            'social-isolation.html': ['social-isolation', 'social isolation'],
            'mood-swings.html': ['mood-swings', 'mood swings'],
            'sedentary-day.html': ['sedentary-day', 'sedentary day'],
            'overtraining.html': ['overtraining'],
            'bad-mood-activity.html': ['bad-mood', 'bad mood'],
            'reduced-metabolism.html': ['reduced-metabolism', 'reduced metabolism'],
            'muscle-weakness.html': ['muscle-weakness', 'muscle weakness'],
            'increased-stress-activity.html': ['increased-stress', 'increased stress'],
            'chronic-fatigue.html': ['chronic-fatigue', 'chronic fatigue']
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const historyList = document.getElementById('history-list');
        const loadingIndicator = document.getElementById('loading-indicator');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalText = document.getElementById('modalText');
        const bulkDeleteModal = document.getElementById('bulkDeleteModal');
        const bulkDeleteText = document.getElementById('bulkDeleteText');
        const deleteSelectedBtn = document.getElementById('delete-selected-btn');

        let allNotifications = [];
        let selectedNotificationIds = [];
        let currentNotificationToDelete = null;

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å localStorage
        function getNotificationsFromStorage() {
            try {
                const notifications = localStorage.getItem(NOTIFICATIONS_STORAGE_KEY);
                return notifications ? JSON.parse(notifications) : [];
            } catch (error) {
                console.error('Error reading notifications from localStorage:', error);
                return [];
            }
        }

        function saveNotificationsToStorage(notifications) {
            try {
                localStorage.setItem(NOTIFICATIONS_STORAGE_KEY, JSON.stringify(notifications));
                return true;
            } catch (error) {
                console.error('Error saving notifications to localStorage:', error);
                showToast('Error saving notifications');
                return false;
            }
        }

        function generateNotificationId() {
            let lastId = parseInt(localStorage.getItem(LAST_NOTIFICATION_ID_KEY) || '0');
            lastId++;
            localStorage.setItem(LAST_NOTIFICATION_ID_KEY, lastId.toString());
            return lastId;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function () {
            console.log('?? Inbox: Initializing...');

            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 600,
                    once: true
                });
            }

            loadNotifications();
            setupEventListeners();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏–∑ localStorage
        function loadNotifications() {
            try {
                showLoading(true);
                
                const allStoredNotifications = getNotificationsFromStorage();
                console.log('?? Loaded notifications from localStorage:', allStoredNotifications.length);

                // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–∏–º–ø—Ç–æ–º–∞—Ö
                const symptomNotifications = allStoredNotifications.filter(
                    notification => notification.type === 'symptom_recommendations'
                );

                console.log(`?? Symptom notifications: ${symptomNotifications.length}`);

                allNotifications = symptomNotifications;

                if (symptomNotifications.length === 0) {
                    showEmptyState('No symptom notifications yet. Save a day with symptoms in Space');
                    console.log('?? No symptom notifications found');
                } else {
                    renderNotifications(symptomNotifications);
                    console.log('? Notifications rendered');
                }

                updateSelectedCount();
            } catch (error) {
                console.error('? Error loading notifications:', error);
                showEmptyState('Error loading notifications');
            } finally {
                showLoading(false);
            }
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—á—Ç–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ —É–±–∏—Ä–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ API

        // –†–µ–Ω–¥–µ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function renderNotifications(notifications) {
            console.log('?? Rendering', notifications.length, 'notifications');
            historyList.innerHTML = '';

            notifications.forEach(notification => {
                const notificationElement = createNotificationElement(notification);
                historyList.appendChild(notificationElement);
            });

            if (typeof AOS !== 'undefined') {
                AOS.refresh();
            }

            console.log('? Notifications rendered successfully');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function createNotificationElement(notification) {
            const div = document.createElement('div');
            div.className = 'notification';
            div.dataset.id = notification.id;

            const { date, recommendations, symptomCount, allSymptoms } = parseNotificationMessage(notification.message);

            const sentDate = new Date(notification.sent_at);
            const formattedTime = sentDate.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });

            const displayDate = date || sentDate.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });

            const groupedSymptoms = groupSymptomsByPage(allSymptoms);

            div.innerHTML = `
                <div class="notification-header-compact">
                    <div class="notification-title-row">
                        <span class="notification-date-badge">üìÖ ${displayDate}</span>
                        ${symptomCount > 0 ?
                            `<span class="notification-symptoms-count">${symptomCount} symptom${symptomCount > 1 ? 's' : ''}</span>`
                            : ''}
                    </div>
                    <input type="checkbox"
                           class="notification-checkbox"
                           onchange="window.toggleNotificationSelection(${notification.id}, this.checked)">
                </div>

                ${recommendations.length > 0 ? `
                    <div class="recommendations-grid">
                        ${recommendations.map(rec => {
                            const symptomsForRec = extractSymptomsForRecommendation(rec, allSymptoms);

                            return `
                                <div class="recommendation-card">
                                    <div class="recommendation-header">
                                        <div class="recommendation-title">
                                            <span class="recommendation-icon">üìå</span>
                                            ${rec.title}
                                        </div>
                                    </div>
                                    ${rec.description ? `
                                        <div class="recommendation-description">
                                            ${rec.description}
                                        </div>
                                    ` : ''}
                                    ${symptomsForRec.length > 0 ? `
                                        <div class="symptom-buttons-container">
                                            ${symptomsForRec.map(symptom => {
                                                const page = getSymptomPage(symptom);
                                                const displayName = getDisplayNameForSymptom(symptom, page);

                                                if (!page || !displayName) return '';

                                                return `
                                                    <a href="${page}"
                                                       class="symptom-button"
                                                       target="_blank"
                                                       title="Go to ${displayName} page">
                                                        ${displayName}
                                                    </a>
                                                `;
                                            }).filter(btn => btn !== '').join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                ` : `
                    <div class="no-recommendations">
                        No specific recommendations available
                    </div>
                `}

                <div class="notification-footer-compact">
                    <div class="notification-time">
                        üì• Received at ${formattedTime}
                    </div>
                    <div class="notification-actions-compact">
                        <button class="delete-btn-compact"
                                onclick="window.showDeleteConfirm(${notification.id})"
                                title="Delete notification">
                            <svg viewBox="0 0 24 24">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

            return div;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function groupSymptomsByPage(symptoms) {
            const groups = {};
            symptoms.forEach(symptom => {
                const page = getSymptomPage(symptom);
                if (page) {
                    if (!groups[page]) groups[page] = [];
                    const existingSymptom = groups[page].find(s =>
                        getDisplayNameForSymptom(s, page) === getDisplayNameForSymptom(symptom, page)
                    );
                    if (!existingSymptom) groups[page].push(symptom);
                }
            });
            return groups;
        }

        function getDisplayNameForSymptom(symptom, page) {
            if (!page) return formatSymptomName(symptom);
            if (page === 'insomnia.html') {
                const insomniaSymptoms = SYMPTOM_GROUPING['insomnia.html'] || [];
                if (insomniaSymptoms.includes(symptom.toLowerCase()) ||
                    insomniaSymptoms.includes(symptom.replace(/-/g, ' ').toLowerCase())) {
                    return 'Insomnia';
                }
            }
            for (const [pageKey, symptoms] of Object.entries(SYMPTOM_GROUPING)) {
                if (pageKey === page) return formatSymptomName(symptoms[0]);
            }
            return formatSymptomName(symptom);
        }

        function extractSymptomsForRecommendation(recommendation, allSymptoms) {
            const symptomsForRec = [];
            const recText = (recommendation.title + ' ' + recommendation.description).toLowerCase();
            allSymptoms.forEach(symptom => {
                const symptomVariants = getSymptomVariants(symptom);
                for (const variant of symptomVariants) {
                    if (recText.includes(variant.toLowerCase()) ||
                        recommendation.title.toLowerCase().includes(variant.toLowerCase()) ||
                        (recommendation.symptoms && recommendation.symptoms.some(s =>
                            getNormalizedSymptom(s) === getNormalizedSymptom(symptom)))) {
                        const page = getSymptomPage(symptom);
                        const displayName = getDisplayNameForSymptom(symptom, page);
                        const alreadyAdded = symptomsForRec.some(addedSymptom => {
                            const addedPage = getSymptomPage(addedSymptom);
                            const addedDisplayName = getDisplayNameForSymptom(addedSymptom, addedPage);
                            return addedDisplayName === displayName;
                        });
                        if (!alreadyAdded) symptomsForRec.push(symptom);
                        break;
                    }
                }
            });
            return symptomsForRec;
        }

        function getNormalizedSymptom(symptom) {
            return symptom.toLowerCase().replace(/[-_]/g, ' ').trim();
        }

        function getSymptomPage(symptomName) {
            const lowerSymptom = getNormalizedSymptom(symptomName);
            for (const [page, symptoms] of Object.entries(SYMPTOM_GROUPING)) {
                if (symptoms.some(s => getNormalizedSymptom(s) === lowerSymptom)) return page;
            }
            for (const [page, symptoms] of Object.entries(SYMPTOM_GROUPING)) {
                for (const symptom of symptoms) {
                    const normalizedSymptom = getNormalizedSymptom(symptom);
                    if (lowerSymptom.includes(normalizedSymptom) || normalizedSymptom.includes(lowerSymptom)) {
                        return page;
                    }
                }
            }
            return null;
        }

        function getSymptomVariants(symptom) {
            const normalized = getNormalizedSymptom(symptom);
            const variants = [normalized];
            variants.push(normalized.replace(/ /g, '-'));
            variants.push(normalized.replace(/ /g, '_'));
            variants.push(normalized.replace(/-/g, ' '));
            variants.push(normalized.replace(/_/g, ' '));
            return [...new Set(variants)];
        }

        function formatSymptomName(symptom) {
            return symptom
                .split(/[-_]/)
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ')
                .replace(/\b\w/g, l => l.toUpperCase());
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        function parseNotificationMessage(message) {
            console.log('Raw message to parse:', message);
            const lines = message.split('\n');
            console.log('Lines:', lines);

            let date = '';
            let symptomCount = 0;
            const recommendations = [];
            const allSymptoms = [];
            let currentRecommendation = null;

            function parseNotificationMessage(message) {
    console.log('Raw message to parse:', message);
    
    // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    if (!message || message.trim() === '' || 
        message.includes('No specific recommendations') ||
        (!message.includes('1.') && !message.includes('recommendations', 'Recommendations'))) {
        
        // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–º–ø—Ç–æ–º–æ–≤
        const date = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        return {
            date: date,
            recommendations: [{
                title: 'Health Tracking',
                description: 'Continue monitoring your symptoms for personalized recommendations.',
                symptoms: []
            }],
            symptomCount: 1,
            allSymptoms: ['tracking']
        };
    }
    
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –ø–∞—Ä—Å–∏–Ω–≥–∞ ...
}
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                if (line.includes('Daily Recommendations for')) {
                    const dateMatch = line.match(/Daily Recommendations for (.+)/);
                    if (dateMatch) date = dateMatch[1].trim();
                } else if (line.includes('Date:')) {
                    date = line.replace('Date:', '').trim();
                } else if (line.includes('üìã Daily Recommendations')) {
                    const dateMatch = line.match(/üìã Daily Recommendations - (.+)/);
                    if (dateMatch) date = dateMatch[1].trim();
                }

                if (line.includes('Total symptoms tracked:')) {
                    const match = line.match(/Total symptoms tracked: (\d+)/);
                    if (match) symptomCount = parseInt(match[1]);
                } else if (line.includes('Total symptoms:')) {
                    const match = line.match(/Total symptoms: (\d+)/);
                    if (match) symptomCount = parseInt(match[1]);
                }

                if (line.includes('Symptoms:')) {
                    const symptomsPart = line.replace('Symptoms:', '').trim();
                    const symptoms = symptomsPart.split(',').map(s => s.trim()).filter(s => s);
                    allSymptoms.push(...symptoms);
                }

                if (line.match(/^\d+\.\s+.+:/)) {
                    if (currentRecommendation) recommendations.push(currentRecommendation);
                    const match = line.match(/^\d+\.\s+(.+?):\s*(.+)/);
                    if (match) {
                        currentRecommendation = {
                            title: match[1].trim(),
                            description: match[2].trim(),
                            symptoms: []
                        };
                        const descSymptoms = extractSymptomsFromText(match[2]);
                        if (descSymptoms.length > 0) {
                            currentRecommendation.symptoms = descSymptoms;
                            allSymptoms.push(...descSymptoms);
                        }
                    }
                } else if (line.match(/^\d+\.\s+[^:]+$/)) {
                    if (currentRecommendation) recommendations.push(currentRecommendation);
                    const titleMatch = line.match(/^\d+\.\s+(.+)/);
                    if (titleMatch) {
                        currentRecommendation = {
                            title: titleMatch[1].trim(),
                            description: '',
                            symptoms: []
                        };
                    }
                } else if (currentRecommendation && line && !line.match(/^\d+\./) &&
                    !line.includes('Total symptoms') && !line.includes('Symptoms:')) {
                    if (!currentRecommendation.description) {
                        currentRecommendation.description = line.trim();
                    } else {
                        currentRecommendation.description += ' ' + line.trim();
                    }
                    const extraSymptoms = extractSymptomsFromText(line);
                    if (extraSymptoms.length > 0) {
                        currentRecommendation.symptoms.push(...extraSymptoms);
                        allSymptoms.push(...extraSymptoms);
                    }
                }
            }

            if (currentRecommendation) recommendations.push(currentRecommendation);

            if (allSymptoms.length === 0) {
                recommendations.forEach(rec => {
                    const titleSymptoms = extractSymptomsFromText(rec.title);
                    if (titleSymptoms.length > 0) {
                        rec.symptoms = titleSymptoms;
                        allSymptoms.push(...titleSymptoms);
                    }
                });
            }

            const uniqueSymptoms = [...new Set(allSymptoms.map(s => getNormalizedSymptom(s)))].map(s => {
                const original = allSymptoms.find(os => getNormalizedSymptom(os) === s);
                return original || s;
            });

            console.log('Parsed notification result:', {
                date,
                symptomCount,
                recommendationsCount: recommendations.length,
                allSymptoms: uniqueSymptoms
            });

            return {
                date,
                recommendations,
                symptomCount: uniqueSymptoms.length,
                allSymptoms: uniqueSymptoms
            };
        }

        function extractSymptomsFromText(text) {
            if (!text) return [];
            const foundSymptoms = [];
            const lowerText = text.toLowerCase();
            for (const [page, symptoms] of Object.entries(SYMPTOM_GROUPING)) {
                for (const symptom of symptoms) {
                    const normalizedSymptom = getNormalizedSymptom(symptom);
                    const symptomVariants = getSymptomVariants(symptom);
                    for (const variant of symptomVariants) {
                        if (lowerText.includes(variant.toLowerCase())) {
                            if (!foundSymptoms.some(s => getNormalizedSymptom(s) === normalizedSymptom)) {
                                foundSymptoms.push(symptom);
                            }
                            break;
                        }
                    }
                }
            }
            return foundSymptoms;
        }

        // –í—ã–±–æ—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        window.toggleNotificationSelection = function (id, checked) {
            if (checked) {
                if (!selectedNotificationIds.includes(id)) {
                    selectedNotificationIds.push(id);
                }
            } else {
                selectedNotificationIds = selectedNotificationIds.filter(item => item !== id);
            }
            updateSelectedCount();
        };

        // Select All
        function toggleSelectAllWrapper() {
            const checkbox = document.getElementById('select-all-checkbox');
            const newState = !checkbox.checked;
            checkbox.checked = newState;
            toggleSelectAll(newState);
            const customCheckbox = document.querySelector('.custom-checkbox');
            if (newState) customCheckbox.classList.add('checked');
            else customCheckbox.classList.remove('checked');
        }

        window.toggleSelectAll = function (checked) {
            selectedNotificationIds = [];
            if (checked) selectedNotificationIds = allNotifications.map(n => n.id);
            document.getElementById('select-all-checkbox').checked = checked;
            const customCheckbox = document.querySelector('.custom-checkbox');
            if (checked) customCheckbox.classList.add('checked');
            else customCheckbox.classList.remove('checked');
            const checkboxes = document.querySelectorAll('.notification-checkbox');
            checkboxes.forEach(checkbox => checkbox.checked = checked);
            updateSelectedCount();
        };

        function updateSelectedCount() {
            const count = selectedNotificationIds.length;
            if (count > 0) {
                deleteSelectedBtn.classList.add('visible');
                deleteSelectedBtn.textContent = `Delete Selected (${count})`;
            } else {
                deleteSelectedBtn.classList.remove('visible');
            }
            if (allNotifications.length > 0) {
                const checkbox = document.getElementById('select-all-checkbox');
                const customCheckbox = document.querySelector('.custom-checkbox');
                const allSelected = selectedNotificationIds.length === allNotifications.length;
                checkbox.checked = allSelected;
                if (allSelected) customCheckbox.classList.add('checked');
                else customCheckbox.classList.remove('checked');
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        window.showDeleteConfirm = function (id) {
            currentNotificationToDelete = id;
            modalText.textContent = 'Are you sure you want to delete this notification?';
            modalOverlay.style.display = 'flex';
        };

        window.showBulkDeleteConfirm = function () {
            if (selectedNotificationIds.length === 0) return;
            const count = selectedNotificationIds.length;
            bulkDeleteText.textContent = `Are you sure you want to delete ${count} selected notification${count > 1 ? 's' : ''}?`;
            bulkDeleteModal.style.display = 'flex';
        };

        window.confirmDelete = async function () {
            if (!currentNotificationToDelete) return;
            try {
                console.log(`??? Deleting notification ${currentNotificationToDelete}`);
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
                const updatedNotifications = allNotifications.filter(n => n.id !== currentNotificationToDelete);
                if (saveNotificationsToStorage(updatedNotifications)) {
                    allNotifications = updatedNotifications;
                    selectedNotificationIds = selectedNotificationIds.filter(id => id !== currentNotificationToDelete);
                    renderNotifications(allNotifications);
                    updateSelectedCount();
                    showToast('Notification deleted');
                    console.log('? Notification deleted successfully');
                }
            } catch (error) {
                console.error('? Error deleting notification:', error);
                showToast('Error deleting notification');
            } finally {
                closeModal();
            }
        };

        window.confirmBulkDelete = async function () {
            if (selectedNotificationIds.length === 0) {
                closeBulkDeleteModal();
                return;
            }
            try {
                console.log(`??? Bulk deleting ${selectedNotificationIds.length} notifications`);
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
                const updatedNotifications = allNotifications.filter(n => !selectedNotificationIds.includes(n.id));
                if (saveNotificationsToStorage(updatedNotifications)) {
                    allNotifications = updatedNotifications;
                    selectedNotificationIds = [];
                    renderNotifications(allNotifications);
                    updateSelectedCount();
                    showToast('Notifications deleted');
                    console.log('? Bulk delete successful');
                }
            } catch (error) {
                console.error('? Error bulk deleting:', error);
                showToast('Error deleting notifications');
            } finally {
                closeBulkDeleteModal();
            }
        };

        window.closeModal = function () {
            modalOverlay.style.display = 'none';
            currentNotificationToDelete = null;
        };

        window.closeBulkDeleteModal = function () {
            bulkDeleteModal.style.display = 'none';
        };

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ UI
        function showEmptyState(message) {
            historyList.innerHTML = `
                <div class="empty-state" style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 20px; color: #ffffff; margin-bottom: 20px; font-weight: 600;">${message}</div>
                    <div style="display: flex; flex-direction: column; gap: 12px; align-items: center;">
                        <button onclick="loadNotifications()" class="symptom-button" style="cursor: pointer;">
                            üîÑ Retry Loading
                        </button>
                    </div>
                </div>
            `;
        }

        function showLoading(show) {
            loadingIndicator.style.display = show ? 'block' : 'none';
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(20, 20, 25, 0.95);
                backdrop-filter: blur(20px);
                color: white;
                padding: 14px 24px;
                border-radius: 12px;
                z-index: 10000;
                animation: fadeInOut 3s ease-in-out;
                border: 1px solid rgba(255, 255, 255, 0.1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
                font-weight: 500;
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function setupEventListeners() {
            modalOverlay.addEventListener('click', function (e) {
                if (e.target === modalOverlay) closeModal();
            });
            bulkDeleteModal.addEventListener('click', function (e) {
                if (e.target === bulkDeleteModal) closeBulkDeleteModal();
            });
        }

        // CSS –¥–ª—è toast
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateY(-20px); }
                10% { opacity: 1; transform: translateY(0); }
                90% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }
        `;
        document.head.appendChild(style);

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏
        window.loadNotifications = loadNotifications;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ space.html)
        window.createNotificationFromDayData = function(dayData, date) {
            try {
                // –°–æ–∑–¥–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏–º–ø—Ç–æ–º–æ–≤
                const recommendations = generateRecommendations(dayData);
                const symptoms = getAllSymptoms(dayData);
                
                const message = generateNotificationMessage(date, recommendations, symptoms);
                
                const notification = {
                    id: generateNotificationId(),
                    type: 'symptom_recommendations',
                    message: message,
                    sent_at: new Date().toISOString(),
                    read: false
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                const currentNotifications = getNotificationsFromStorage();
                currentNotifications.unshift(notification); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
                saveNotificationsToStorage(currentNotifications);
                
                console.log('? Notification created:', notification);
                return true;
            } catch (error) {
                console.error('Error creating notification:', error);
                return false;
            }
        };

        function generateRecommendations(dayData) {
            const recommendations = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–Ω
            if (dayData.sleepQuality === 'poor-sleep' || 
                (dayData.sleepIssues && dayData.sleepIssues.length > 0)) {
                recommendations.push({
                    title: 'Sleep Quality',
                    description: 'Improve your sleep hygiene with regular bedtime routine and reduced screen time before sleep.',
                    symptoms: ['insomnia', 'poor-sleep', ...(dayData.sleepIssues || [])]
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–¥—É
            if (dayData.waterIntake === 'too-little' || 
                (dayData.dehydrationSymptoms && dayData.dehydrationSymptoms.length > 0)) {
                recommendations.push({
                    title: 'Hydration',
                    description: 'Increase water intake to at least 2 liters per day. Consider using a water tracking app.',
                    symptoms: ['headache', 'fatigue', 'dry-skin-mucous', ...(dayData.dehydrationSymptoms || [])]
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
            if ((dayData.mood && dayData.mood <= 4) || 
                (dayData.moodRelated && dayData.moodRelated.length > 0)) {
                recommendations.push({
                    title: 'Mood Management',
                    description: 'Practice mindfulness, consider light exercise, and maintain social connections.',
                    symptoms: ['stress', 'anxiety', 'depressive-episode', ...(dayData.moodRelated || [])]
                });
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            if ((dayData.activityLevel && (dayData.activityLevel <= 3 || dayData.activityLevel >= 8)) || 
                (dayData.activityIssues && dayData.activityIssues.length > 0)) {
                recommendations.push({
                    title: 'Activity Balance',
                    description: 'Aim for moderate daily activity. Balance rest and movement for optimal health.',
                    symptoms: ['sedentary-day', 'overtraining', 'chronic-fatigue', ...(dayData.activityIssues || [])]
                });
            }
            
            return recommendations;
        }

        function getAllSymptoms(dayData) {
            const symptoms = [];
            
            if (dayData.sleepQuality === 'poor-sleep') symptoms.push('poor-sleep');
            if (dayData.sleepIssues) symptoms.push(...dayData.sleepIssues);
            
            if (dayData.waterIntake === 'too-little') symptoms.push('dehydration');
            if (dayData.dehydrationSymptoms) symptoms.push(...dayData.dehydrationSymptoms);
            
            if (dayData.mood && dayData.mood <= 4) symptoms.push('low-mood');
            if (dayData.moodRelated) symptoms.push(...dayData.moodRelated);
            
            if (dayData.activityLevel && (dayData.activityLevel <= 3 || dayData.activityLevel >= 8)) {
                symptoms.push(dayData.activityLevel <= 3 ? 'low-activity' : 'high-activity');
            }
            if (dayData.activityIssues) symptoms.push(...dayData.activityIssues);
            
            return [...new Set(symptoms)];
        }

        function generateNotificationMessage(date, recommendations, symptoms) {
            let message = `üìã Daily Recommendations - ${date}\n\n`;
            message += `Total symptoms tracked: ${symptoms.length}\n`;
            
            if (symptoms.length > 0) {
                message += `Symptoms: ${symptoms.join(', ')}\n\n`;
            }
            
            if (recommendations.length > 0) {
                recommendations.forEach((rec, index) => {
                    message += `${index + 1}. ${rec.title}: ${rec.description}\n`;
                });
            } else {
                message += "No specific recommendations. Keep up the good work!\n";
            }
            
            return message;
        }
    </script>
</body>
</html>

